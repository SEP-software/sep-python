============================= test session starts ==============================
platform linux -- Python 3.10.8, pytest-7.2.0, pluggy-1.0.0
rootdir: /home/clapp_stanford_edu/Src/sep-python
collected 7 items

test_Hypercube.py .                                                      [ 14%]
test_modes.py F                                                          [ 28%]
test_sepfile.py FF.F.                                                    [100%]

=================================== FAILURES ===================================
_________________________________ test_sepMode _________________________________

    def test_sepMode():
        io=sepPython.modes.defaultIO
        hyper=hypercube(ns=[10,20],os=[1.,2.],ds=[2.,3])
        ar=np.ndarray((20,10))
        for j in range(ar.shape[0]):
            for i in range(ar.shape[1]):
                ar[j,i]=100*j+i
    
        vec=io.getRegVector(ar,hyper=hyper)
        fle=io.getRegStorage(vec=vec,path="gs://scratch-sep/junk3.H")
        fle.writeDescription()
        fle.write(ar)
        fle.close()
    
        fl2=io.getRegStorage(path="gs://scratch-sep/junk3.H")
        ar2=np.zeros((20,10))
        fl2.read(ar2)
        for j in range(ar.shape[0]):
            for i in range(ar.shape[1]):
                assert ar[j,i] == ar2[j,i]
    
        fl3=io.getRegStorage(vec=vec,path="/tmp/junk4.H")
        fl3.close()
    
>       fl4=io.getRegStorage(path="/tmp/junk4.H")

test_modes.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py:57: in getRegStorage
    stor=sFile(**kw)
/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py:441: in __init__
    super().__init__(**kw)
/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py:202: in __init__
    self._params=self.buildParamsFromPath(kw["path"],**kw)
/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py:227: in buildParamsFromPath
    pars=self.getHistoryDict(fle)
/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py:472: in getHistoryDict
    pars=databaseFromStr(self._history,pars)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

strIn = 'b\'\nGeneric Python Program\n\nn1=10 o1=1.0 d1=2.0 label1="ax.label" unit1="ax.unit"\nn2=20 o2=2.0 d2=3 label2="ax.label" unit2="ax.unit"\nin=/tmp/junk4.H@\nesize=8 data_format=native_double\n\n\''
dataB = {}

    def databaseFromStr(strIn:str,dataB:dict):
      lines=strIn.split("\n")
      parq1=re.compile(r'([^\s]+)="(.+)"')
      parq2=re.compile(r"(\S+)='(.+)'")
      parS=re.compile(r'(\S+)=(\S+)')
      commaS=re.compile(',')
      for line in lines:
        args=line.split()
        comment=0
        for arg in args:
          if arg[0]=="#": comment=1
          res=None
          if comment!=1:
            q=0
            res=parq1.search(arg)
            if res:
              q=1
              meth=0
            else:
              res=parq2.search(arg)
              if res:
                q=1
                meth=1
              else:
                res=parS.search(arg)
                meth=2
          if res:
            if res.group(1)=="par":
              try:
                f2=open(res.group(2))
              except:
                self._logger.fatal(f"Trouble opening {res.group(2)}")
                raise Exception("")
              databaseFromStr(f2.read(),dataB)
              f2.close()
            else:
              val=res.group(2)
              if isinstance(val,str):
                if commaS.search(val): val=val.split(",")
>             if isinstance(res.group(1),bytestring):
E             NameError: name 'bytestring' is not defined

/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py:105: NameError
____________________________ test_simpleArgs_1Line _____________________________

    def test_simpleArgs_1Line():
        f=open("/tmp/junk.H","w")
        f.write("n1=10 o1=1. d1=2. label='test' in='/tmp/junk.H@'\n")
        f.close()
>       fl=sepPython.sepIO.sFile(path="/tmp/junk.H")

test_sepfile.py:15: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py:441: in __init__
    super().__init__(**kw)
/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py:202: in __init__
    self._params=self.buildParamsFromPath(kw["path"],**kw)
/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py:227: in buildParamsFromPath
    pars=self.getHistoryDict(fle)
/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py:472: in getHistoryDict
    pars=databaseFromStr(self._history,pars)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

strIn = 'b"n1=10 o1=1. d1=2. label=\'test\' in=\'/tmp/junk.H@\'\n"', dataB = {}

    def databaseFromStr(strIn:str,dataB:dict):
      lines=strIn.split("\n")
      parq1=re.compile(r'([^\s]+)="(.+)"')
      parq2=re.compile(r"(\S+)='(.+)'")
      parS=re.compile(r'(\S+)=(\S+)')
      commaS=re.compile(',')
      for line in lines:
        args=line.split()
        comment=0
        for arg in args:
          if arg[0]=="#": comment=1
          res=None
          if comment!=1:
            q=0
            res=parq1.search(arg)
            if res:
              q=1
              meth=0
            else:
              res=parq2.search(arg)
              if res:
                q=1
                meth=1
              else:
                res=parS.search(arg)
                meth=2
          if res:
            if res.group(1)=="par":
              try:
                f2=open(res.group(2))
              except:
                self._logger.fatal(f"Trouble opening {res.group(2)}")
                raise Exception("")
              databaseFromStr(f2.read(),dataB)
              f2.close()
            else:
              val=res.group(2)
              if isinstance(val,str):
                if commaS.search(val): val=val.split(",")
>             if isinstance(res.group(1),bytestring):
E             NameError: name 'bytestring' is not defined

/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py:105: NameError
___________________________ test_simpleWriteHistory ____________________________

    def test_simpleWriteHistory():
        hyper=hypercube(ns=[10,12],os=[2.,1.])
        fle=sepPython.sepIO.sFile(hyper=hyper,path="/tmp/junk.H",type="float64")
        fle.writeDescription()
>       fin=sepPython.sepIO.sFile(path="/tmp/junk.H")

test_sepfile.py:26: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py:441: in __init__
    super().__init__(**kw)
/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py:202: in __init__
    self._params=self.buildParamsFromPath(kw["path"],**kw)
/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py:227: in buildParamsFromPath
    pars=self.getHistoryDict(fle)
/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py:472: in getHistoryDict
    pars=databaseFromStr(self._history,pars)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

strIn = 'b\'\nGeneric Python Program\n\nn1=10 o1=2.0 d1=1.0 label1="ax.label" unit1="ax.unit"\nn2=12 o2=1.0 d2=1.0 label2="ax.label" unit2="ax.unit"\nin=/tmp/junk.H@\nesize=None data_format=native_double\n\n\''
dataB = {}

    def databaseFromStr(strIn:str,dataB:dict):
      lines=strIn.split("\n")
      parq1=re.compile(r'([^\s]+)="(.+)"')
      parq2=re.compile(r"(\S+)='(.+)'")
      parS=re.compile(r'(\S+)=(\S+)')
      commaS=re.compile(',')
      for line in lines:
        args=line.split()
        comment=0
        for arg in args:
          if arg[0]=="#": comment=1
          res=None
          if comment!=1:
            q=0
            res=parq1.search(arg)
            if res:
              q=1
              meth=0
            else:
              res=parq2.search(arg)
              if res:
                q=1
                meth=1
              else:
                res=parS.search(arg)
                meth=2
          if res:
            if res.group(1)=="par":
              try:
                f2=open(res.group(2))
              except:
                self._logger.fatal(f"Trouble opening {res.group(2)}")
                raise Exception("")
              databaseFromStr(f2.read(),dataB)
              f2.close()
            else:
              val=res.group(2)
              if isinstance(val,str):
                if commaS.search(val): val=val.split(",")
>             if isinstance(res.group(1),bytestring):
E             NameError: name 'bytestring' is not defined

/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py:105: NameError
_____________________________ test_simpleWriteRead _____________________________

    def test_simpleWriteRead():
        ar=np.ndarray((20,10))
        for j in range(ar.shape[0]):
            for i in range(ar.shape[1]):
                ar[j,i]=100*j+i
        fle=sepPython.sepIO.sFile(array=ar,path="/tmp/junk2.H")
        fle.writeDescription()
        fle.write(ar)
>       fl2=sepPython.sepIO.sFile(path="/tmp/junk2.H")

test_sepfile.py:50: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py:441: in __init__
    super().__init__(**kw)
/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py:202: in __init__
    self._params=self.buildParamsFromPath(kw["path"],**kw)
/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py:227: in buildParamsFromPath
    pars=self.getHistoryDict(fle)
/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py:472: in getHistoryDict
    pars=databaseFromStr(self._history,pars)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

strIn = 'b\'\nGeneric Python Program\n\nn1=10 o1=0.0 d1=1.0 label1="ax.label" unit1="ax.unit"\nn2=20 o2=0.0 d2=1.0 label2="ax.label" unit2="ax.unit"\nin=/tmp/junk2.H@\nesize=8 data_format=native_double\n\n\''
dataB = {}

    def databaseFromStr(strIn:str,dataB:dict):
      lines=strIn.split("\n")
      parq1=re.compile(r'([^\s]+)="(.+)"')
      parq2=re.compile(r"(\S+)='(.+)'")
      parS=re.compile(r'(\S+)=(\S+)')
      commaS=re.compile(',')
      for line in lines:
        args=line.split()
        comment=0
        for arg in args:
          if arg[0]=="#": comment=1
          res=None
          if comment!=1:
            q=0
            res=parq1.search(arg)
            if res:
              q=1
              meth=0
            else:
              res=parq2.search(arg)
              if res:
                q=1
                meth=1
              else:
                res=parS.search(arg)
                meth=2
          if res:
            if res.group(1)=="par":
              try:
                f2=open(res.group(2))
              except:
                self._logger.fatal(f"Trouble opening {res.group(2)}")
                raise Exception("")
              databaseFromStr(f2.read(),dataB)
              f2.close()
            else:
              val=res.group(2)
              if isinstance(val,str):
                if commaS.search(val): val=val.split(",")
>             if isinstance(res.group(1),bytestring):
E             NameError: name 'bytestring' is not defined

/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py:105: NameError
=============================== warnings summary ===============================
test/test_sepfile.py::test_simpleWriteHistoryGCS
test/test_sepfile.py::test_simpleWriteReadGCP
  /home/clapp_stanford_edu/.local/lib/python3.10/site-packages/_pytest/unraisableexception.py:78: PytestUnraisableExceptionWarning: Exception ignored in: <function sGcsObj.__del__ at 0x7fafffcb4790>
  
  Traceback (most recent call last):
    File "/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py", line 720, in __del__
      raise Exception("")
  Exception
  
    warnings.warn(pytest.PytestUnraisableExceptionWarning(msg))

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED test_modes.py::test_sepMode - NameError: name 'bytestring' is not defined
FAILED test_sepfile.py::test_simpleArgs_1Line - NameError: name 'bytestring' ...
FAILED test_sepfile.py::test_simpleWriteHistory - NameError: name 'bytestring...
FAILED test_sepfile.py::test_simpleWriteRead - NameError: name 'bytestring' i...
=================== 4 failed, 3 passed, 2 warnings in 2.68s ====================
Exception ignored in: <function regFile.__del__ at 0x7fb001276a70>
Traceback (most recent call last):
  File "/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/ioBase.py", line 209, in __del__
    self.close()
  File "/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py", line 395, in close
    self.writeDescription()
  File "/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py", line 547, in writeDescription
    fl=open(self._path,"w")
AttributeError: 'sFile' object has no attribute '_path'
Exception ignored in: <function regFile.__del__ at 0x7fb001276a70>
Traceback (most recent call last):
  File "/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/ioBase.py", line 209, in __del__
    self.close()
  File "/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py", line 395, in close
    self.writeDescription()
  File "/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py", line 547, in writeDescription
    fl=open(self._path,"w")
AttributeError: 'sFile' object has no attribute '_path'
Exception ignored in: <function regFile.__del__ at 0x7fb001276a70>
Traceback (most recent call last):
  File "/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/ioBase.py", line 209, in __del__
    self.close()
  File "/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py", line 395, in close
    self.writeDescription()
  File "/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py", line 547, in writeDescription
    fl=open(self._path,"w")
AttributeError: 'sFile' object has no attribute '_path'
Exception ignored in: <function regFile.__del__ at 0x7fb001276a70>
Traceback (most recent call last):
  File "/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/ioBase.py", line 209, in __del__
    self.close()
  File "/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py", line 395, in close
    self.writeDescription()
  File "/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py", line 547, in writeDescription
    fl=open(self._path,"w")
AttributeError: 'sFile' object has no attribute '_path'
Must close gcs object before the delete is called
Exception ignored in: <function sGcsObj.__del__ at 0x7fafffcb4790>
Traceback (most recent call last):
  File "/home/spack/spack/opt/spack/linux-centos7-skylake_avx512/gcc-8.5.0/python-3.10.8-tye3styllri3xiql6psptyz7uujbz4hn/lib/python3.10/site-packages/sepPython/sepIO.py", line 720, in __del__
Exception: 
